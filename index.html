<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>橘子小镇论坛 - 帖子详情</title>
<style>
    body{ margin:0; font-family:-apple-system,BlinkMacSystemFont,Tahoma,Arial; background-image:url("orange.png"); background-repeat:repeat; background-size:120px; background-color: #fdf6ec; }
    .phone{ max-width:420px; margin:20px auto; background:#fffdf8; border-radius:18px; box-shadow:0 8px 30px rgba(0,0,0,0.08); overflow:hidden; min-height: 90vh; }
    .topbar{ background:#c58f5c; color:white; padding:12px; font-size:15px; text-align:center; position:relative; }
    .back-home{ position:absolute; left:12px; cursor:pointer; font-size:13px; opacity:0.9; }
    .thread-title{ padding:14px; font-size:15px; font-weight:bold; background:#f6efe5; border-bottom:1px solid #eee3d4; color: #5a4a3a; }
    .meta{ padding:8px 14px; font-size:12px; color:#8c7c6d; border-bottom:1px solid #f0e6d8; }
    .toolbar{ padding:8px 14px; font-size:12px; background:#faf6ef; border-bottom:1px solid #f0e6d8; display: flex; gap: 15px; }
    .toolbar span{ color:#a05d2c; cursor:pointer; padding: 2px 6px; border-radius: 4px; }
    .toolbar span.active { background: #e6d6bf; font-weight: bold; }
    .post{ padding:12px 14px; border-bottom:1px solid #f3eadf; }
    .username{ font-size:13px; font-weight:bold; margin-bottom:4px; color: #4a3c2e; }
    .meta-user{ font-size:11px; color:#9c8b7d; margin-bottom:6px; }
    .floor{ font-size:12px; color:#8c7c6d; margin-bottom:4px; font-family: Georgia, serif; }
    .content{ font-size:14px; line-height:1.6; color: #333; margin:3px 0 5px 0; word-wrap: break-word; }
    .deleted{ color:#b3a79b; font-style:italic; }
    .actions{ margin-top:4px; font-size:12px; display:flex; justify-content:flex-end; }
    .actions span{ margin-left:15px; color:#a05d2c; cursor:pointer; }
    .pagebar{ padding:15px 14px; text-align:center; font-size:13px; background:#faf6ef; border-top: 1px solid #eee; }
    .pagebar span{ margin:0 8px; cursor:pointer; color:#a05d2c; padding: 4px 8px; }
    .pagebar span.current { font-weight:bold; text-decoration: underline; color: #6d3a15; }
    .quote-box{ padding:10px 14px; background:#fff3df; border-top:1px solid #e6d6bf; font-size:13px; color: #7d664a; }
    
    /* --- 论坛回帖引用样式 --- */
    .bbs-quote {
        background: #f1e9db;
        border: 1px solid #e2d2ba;
        padding: 10px;
        margin: 5px 0 15px 0;
        font-size: 12px;
        color: #666;
        border-radius: 4px;
    }
    .quote-header {
        border-bottom: 1px dashed #d1c1a9;
        margin-bottom: 8px;
        padding-bottom: 4px;
        color: #a05d2c;
        font-weight: bold;
    }
    .quote-content { line-height: 1.5; font-style: italic; }

    .content{ font-size:14.5px; line-height:1.7; color: #333; margin:3px 0 5px 0; word-wrap: break-word; white-space: pre-wrap; }
</style>
</head>
<body>

<div class="phone">
    <div class="topbar">
        <span class="back-home" onclick="alert('返回主页')">← 论坛主页</span>
        橘子小镇论坛
    </div>

    <div class="thread-title">
        「求助」我的狗总是对邻居的狗进行骑跨行为，对方主人每次都吓得尖叫，我该怎么道歉？
    </div>

    <div class="meta">浏览量：1843 ｜ 回复：62</div>

    <div class="toolbar">
        <span id="btnAll" class="active" onclick="toggleOP(false)">全部内容</span>
        <span id="btnOP" onclick="toggleOP(true)">只看楼主</span>
    </div>

    <div id="posts"></div>
    <div class="pagebar" id="pagebar"></div>
    <div id="quoteArea"></div>
</div>


<script>
let currentPage = 1;
const OP_NAME = "我家狗狗可爱";
let onlyOP = false;
let allPostsData = {}; 

function getLevel(points){
    if(points > 2000) return "资深居民";
    if(points > 1000) return "常驻居民";
    if(points > 300) return "小镇居民";
    return "新居民";
}

function randomIP(seed) {
    return "IP: 114.242." + (seed % 255) + "." + (Math.floor(seed * 1.5) % 255);
}

function loadPage(page){
    currentPage = page;
    const old = document.getElementById("pageScript");
    if(old) old.remove();
    
    if(allPostsData[page]) {
        renderPosts();
        renderPages();
    } else {
        const script = document.createElement("script");
        script.src = `page${page}.js?v=${Date.now()}`;
        script.id = "pageScript";
        document.body.appendChild(script);
    }
}

function render(data, page){
    allPostsData[page] = data;
    renderPosts();
    renderPages();
}

function renderPosts(){
    const container = document.getElementById("posts");
    container.innerHTML = "";
    const pageData = allPostsData[currentPage] || [];
    
    let globalOffset = 0;
    for(let i = 1; i < currentPage; i++) {
        if(allPostsData[i]) globalOffset += allPostsData[i].length;
    }

    pageData.forEach((p, index) => {
        const floor = globalOffset + index + 1;
        if(onlyOP && p.name !== OP_NAME) return;

        // 生成回帖引用块
        let quoteHTML = "";
        if (p.quoteUser && p.quoteContent) {
            quoteHTML = `
                <div class="bbs-quote">
                    <div class="quote-header">引用 ${p.quoteFloor || '?'} 楼 @${p.quoteUser} 的发言:</div>
                    <div class="quote-content">${p.quoteContent}</div>
                </div>`;
        }

        const postDiv = document.createElement("div");
        postDiv.className = "post";
        postDiv.innerHTML = `
            <div class="username">${p.name} ${p.name===OP_NAME ? '<span style="color:#c58f5c;font-size:11px;">[楼主]</span>' : ''}</div>
            <div class="meta-user">积分 ${p.points || 0} ｜ ${getLevel(p.points || 0)} ｜ ${randomIP(floor)}</div>
            <div class="floor">${floor}楼 ｜ 发表于 ${p.time}</div>
            ${quoteHTML}
            <div class="content">${p.content.replace(/\n/g,"<br>")}</div>
        `;
        container.appendChild(postDiv);
    });
    window.scrollTo(0,0);
}

function renderPages(){
    const bar = document.getElementById("pagebar");
    bar.innerHTML = "";
    const totalPages = 3; // 这里你可以根据实际页数修改

    for(let i = 1; i <= totalPages; i++){
        const span = document.createElement("span");
        span.innerText = i;
        if(i === currentPage) span.className = "current";
        span.onclick = () => loadPage(i);
        bar.appendChild(span);
    }
}

function toggleOP(val){
    onlyOP = val;
    document.getElementById("btnOP").className = val ? "active" : "";
    document.getElementById("btnAll").className = val ? "" : "active";
    renderPosts();
}

function quotePost(floor){
    const area = document.getElementById("quoteArea");
    area.innerHTML = `<div class="quote-box">正在引用第 ${floor} 楼的内容...</div>`;
}

loadPage(1);
</script>

</body>
</html>
