<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŠç ‚ç³–æ©˜ä¸‡äº‹å±‹ğŸŠè®ºå› - å¸–å­è¯¦æƒ…</title>

<script src="config.js"></script> 
<style>
    /* å…¨å±€
    body { 
        margin: 0; 
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif; 
        background-color: #fdf6ec;
        /èƒŒæ™¯
        background-image: radial-gradient(#e6d6bf 2px, transparent 2px);
        background-size: 20px 20px;
    }

    /* ä¸»å®¹å™¨
    .phone { 
        max-width: 420px; 
        margin: 20px auto; 
        background: #fefaf6; 
        /* å¤–æ¡† */
        border-radius: 24px; 
        box-shadow: 
            0 0 0 2px #e6d6bf, /* å¤–åœˆç»†çº¿ */
            0 10px 20px rgba(197, 143, 92, 0.2); /* æŸ”å’ŒæŠ•å½± */
        overflow: hidden; 
        min-height: 90vh; 
    }

    /* é¡¶éƒ¨æ 
    .topbar { 
        background: #c58f5c; 
        color: white; 
        padding: 15px; 
        font-size: 15px; 
        text-align: center; 
        position: relative; 
        font-weight: bold;
        letter-spacing: 1px;
        
    }
    
    /* è¿”å›æŒ‰é’®
    .back-home { 
        position: absolute; 
        left: 15px; 
        top: 14px;
        cursor: pointer; 
        font-size: 12px; 
        background: rgba(255,255,255,0.2); /* åŠé€æ˜ */
        padding: 4px 12px;
        border-radius: 10px; /* èƒ¶å›Šåœ†è§’ */
        border: 1px solid rgba(255,255,255,0.5);
        transition: 0.2s;
    }
    .back-home:hover { background: #fff; color: #c58f5c; }

    /* æ ‡é¢˜åŒº
    .thread-title { 
        padding: 18px; 
        font-size: 16px; 
        font-weight: bold; 
        background: #fff; 
        color: #5a4a3a; 
        line-height: 1.5;
        border-bottom: 2px dashed #e6d6bf;
    }

    /* æ•°æ®æ  */
    .meta { 
        padding: 10px 18px; 
        font-size: 11px; 
        color: #a05d2c; 
        border-bottom: 1px solid #f6efe5; 
        background: #fffcf8;
    }

    /* å·¥å…·æ ï¼šæ°”æ³¡æŒ‰é’® */
    .toolbar { 
        padding: 12px; 
        background: #fffcf8; 
        border-bottom: 1px solid #f0e6d8; 
        display: flex; 
        justify-content: left; /* å·¦å¯¹é½ */
        gap: 15px; 
    }
    .toolbar span { 
        color: #8c7c6d; 
        cursor: pointer; 
        padding: 5px 15px; 
        border-radius: 5px; /* åœ†æ¶¦ */
        background: #f0e6d8;
        font-size: 12px;
        transition: all 0.2s;
    }
    .toolbar span.active { 
        background: #c58f5c; 
        color: #fff; 
        font-weight: bold; 
        box-shadow: 0 4px 10px rgba(197, 143, 92, 0.3); /* æŸ”å’Œå‘å…‰ */
    }

        /* è·‘é©¬ç¯å®¹å™¨ */
    .marquee-wrapper {
        background: #fff8e1; 
        color: #a05d2c;     
        font-family: "Courier New", monospace;
        font-size: 12px;
        padding: 6px 0;
        border-bottom: 2px dashed #e6d6bf;
        overflow: hidden;    
        white-space: nowrap; 
    }

    /* è·‘é©¬ç¯å†…å®¹åŠ¨ç”» */
    .marquee-content {
        display: inline-block;
        padding-left: 100%;  /* ä»æœ€å³è¾¹å¼€å§‹ */
        animation: marquee 15s linear infinite; /* 15ç§’å¾ªç¯ä¸€æ¬¡ */
    }

    /* åŠ¨ç”»å…³é”®å¸§ */
    @keyframes marquee {
        0% { transform: translateX(0); }
        100% { transform: translateX(-100%); }
    }


    /* å¸–å­å†…å®¹ */
    .post { 
        padding: 20px 18px; 
        border-bottom: 1px dashed #e0d0c0; 
    }
    
    .username { 
        font-size: 14px; 
        font-weight: bold; 
        margin-bottom: 6px; 
        color: #4a3c2e; 
    }
    /* æ¥¼ä¸»æ ‡ç­¾ */
    .username span { 
        background: #ffebd7; 
        color: #c3806b !important; 
        padding: 2px 8px; 
        font-size: 11px !important; 
        border-radius: 0px; 
        margin-left: 5px;
    }

    .meta-user { font-size: 11px; color: #bcaaa4; margin-bottom: 8px; }
    .floor { font-size: 12px; color: #c58f5c; margin-bottom: 4px; }

    /* æ­£æ–‡ */
    .content { 
        font-size: 15px; 
        line-height: 1.7; 
        color: #333; 
        margin-top: 5px; 
        word-wrap: break-word; 
    }

    /* å¼•ç”¨å— */
    .bbs-quote { 
        background: #fff8e1; 
        border: none;
        border-left: 4px solid #cfa291; 
        border-radius: 5px; 
        padding: 12px; 
        margin: 12px 0; 
        font-size: 12px; 
        color: #795548; 
    }
    .quote-header { 
        border-bottom: 1px dashed #ffe082; 
        margin-bottom: 6px; 
        padding-bottom: 4px; 
        font-weight: bold; 
    }

    /*ç¿»é¡µæ¡*/
    .pagebar { 
        padding: 20px; 
        text-align: center; 
        background: #fffcf8; 
        border-top: 1px dashed #e6d6bf;
    }
    .pagebar span { 
        display: inline-block;
        min-width: 28px;
        height: 28px;
        line-height: 28px;
        margin: 0 4px; 
        cursor: pointer; 
        border-radius: 50%;
        background: #fff;
        color: #8c7c6d;
        font-size: 12px;
        border: 1px solid #e6d6bf;
        transition: 0.2s;
    }
    .pagebar span.current { 
        background: #c58f5c; 
        color: #fff; 
        border-color: #c58f5c;
        transform: scale(1.1);
        box-shadow: 0 4px 8px rgba(197, 143, 92, 0.3);
    }
</style>


</head>
<body>

<div class="phone">
    <div class="topbar">
        <span class="back-home" onclick="window.location.href='list.html'">â† å¸–å­åˆ—è¡¨</span>
        ğŸŠç ‚ç³–æ©˜ä¸‡äº‹å±‹ğŸŠ
    </div>

     <div class="marquee-wrapper">
        <div class="marquee-content">
            *** æ¬¢è¿æ¥åˆ°ç ‚ç³–æ©˜ä¸‡äº‹å±‹ *** æ–‡æ˜ä¸Šç½‘ï¼Œç†æ€§å‘å¸– *** è¿™é‡Œçš„æ—©é¤å¾ˆå¥½åƒ *** 
        </div>
    </div>


    <div class="thread-title" id="uiTitle">åŠ è½½ä¸­...</div>

    <div class="meta">æµè§ˆé‡ï¼š1843 ï½œ æ”¶è—ï¼š62</div>

    <div class="toolbar">
        <span id="btnAll" class="active" onclick="toggleOP(false)">å…¨éƒ¨å†…å®¹</span>
        <span id="btnOP" onclick="toggleOP(true)">åªçœ‹æ¥¼ä¸»</span>
    </div>

    <div id="posts"></div>
    <div class="pagebar" id="pagebar"></div>
    <div id="quoteArea"></div>
</div>


<script>
// 1. è·å– URL å‚æ•°ä¸­çš„ id
const params = new URLSearchParams(window.location.search);
// é»˜è®¤åŠ è½½ dog_issueï¼Œå¦‚æœ URL é‡Œæ²¡å†™ id
const currentThreadId = params.get('id') || 'dog_issue'; 

// 2. ä» config.js ä¸­è¯»å–å½“å‰å¸–å­çš„ä¿¡æ¯
// å¦‚æœ config æ²¡åŠ è½½æˆ–è€… ID ä¸å­˜åœ¨ï¼Œç»™ä¸€ä¸ªé»˜è®¤å€¼é˜²æ­¢æŠ¥é”™
const threadInfo = (window.forumConfig && window.forumConfig[currentThreadId]) ? window.forumConfig[currentThreadId] : {
    title: "å¸–å­ä¸å­˜åœ¨æˆ– Config æ–‡ä»¶ç¼ºå¤±",
    opName: "",
    totalPages: 0
};

// 3. æ›´æ–°ç•Œé¢ä¸Šçš„æ ‡é¢˜å’Œæ¥¼ä¸»è®¾ç½®
document.getElementById("uiTitle").innerText = threadInfo.title;
document.title = "æ©˜å­å°é•‡ - " + threadInfo.title;

let currentPage = 1;
const OP_NAME = threadInfo.opName; // ä½¿ç”¨é…ç½®é‡Œçš„æ¥¼ä¸»å
let onlyOP = false;
let allPostsData = {}; 

function getLevel(points){
    if(points > 2000) return "èµ„æ·±å±…æ°‘";
    if(points > 1000) return "å¸¸é©»å±…æ°‘";
    if(points > 300) return "å°é•‡å±…æ°‘";
    return "æ–°å±…æ°‘";
}

function randomIP(seed) {
    return "IP: 114.242." + (seed % 255) + "." + (Math.floor(seed * 1.5) % 255);
}

function loadPage(page){
    currentPage = page;
    const old = document.getElementById("pageScript");
    if(old) old.remove();
    
    if(allPostsData[page]) {
        renderPosts();
        renderPages();
    } else {
        const script = document.createElement("script");
        // 4. å…³é”®ä¿®æ”¹ï¼šæ–‡ä»¶ååŠ ä¸Šäº†å¸–å­ ID å‰ç¼€
        // ä¾‹å¦‚åŠ è½½ dog_issue çš„ç¬¬ 1 é¡µ -> dog_issue_page1.js
        script.src = `${currentThreadId}_page${page}.js?v=${Date.now()}`;
        
        script.id = "pageScript";
        // å¢åŠ é”™è¯¯å¤„ç†ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨
        script.onerror = function() {
            alert("æ— æ³•åŠ è½½æ•°æ®ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦ä¸º: " + currentThreadId + "_page" + page + ".js");
        };
        document.body.appendChild(script);
    }
}

function render(data, page){
    allPostsData[page] = data;
    renderPosts();
    renderPages();
}

function renderPosts(){
    const container = document.getElementById("posts");
    container.innerHTML = "";
    const pageData = allPostsData[currentPage] || [];
    
    // è®¡ç®—æ¥¼å±‚åç§»é‡
    let globalOffset = 0;
    for(let i = 1; i < currentPage; i++) {
        if(allPostsData[i]) globalOffset += allPostsData[i].length;
    }

    // å¾ªç¯æ¸²æŸ“æ¯ä¸€æ¡å¸–å­
    pageData.forEach((p, index) => {
        const floor = globalOffset + index + 1;
        
        // å¦‚æœå¼€å¯äº†â€œåªçœ‹æ¥¼ä¸»â€ï¼Œä¸”å½“å‰å‘è¨€äººä¸æ˜¯æ¥¼ä¸»ï¼Œåˆ™è·³è¿‡
        if(onlyOP && p.name !== OP_NAME) return;

        // --- â†“â†“â†“ è¿™é‡Œæ˜¯ä¹‹å‰è¢«çœç•¥æ‰çš„æ ¸å¿ƒä»£ç ï¼Œç°åœ¨è¡¥å›æ¥äº† â†“â†“â†“ ---
        
        // 1. å¤„ç†å¼•ç”¨å›å¤
        let quoteHTML = "";
        if (p.quoteUser && p.quoteContent) {
            quoteHTML = `
                <div class="bbs-quote">
                    <div class="quote-header">å¼•ç”¨ ${p.quoteFloor || '?'} æ¥¼ @${p.quoteUser} çš„å‘è¨€:</div>
                    <div class="quote-content">${p.quoteContent}</div>
                </div>`;
        }

        // 2. åˆ›å»ºå¸–å­ DIV
        const postDiv = document.createElement("div");
        postDiv.className = "post";
        
        // 3. å¡«å…… HTML å†…å®¹
        postDiv.innerHTML = `
            <div class="username">${p.name} ${p.name===OP_NAME ? '<span style="color:#c58f5c;font-size:11px;">[æ¥¼ä¸»]</span>' : ''}</div>
            <div class="meta-user">ç§¯åˆ† ${p.points || 0} ï½œ ${getLevel(p.points || 0)} ï½œ ${randomIP(floor)}</div>
            <div class="floor">${floor}æ¥¼ ï½œ å‘è¡¨äº ${p.time}</div>
            ${quoteHTML}
            <div class="content">${p.content.replace(/\n/g,"<br>")}</div>
        `;


        // å°†å¸–å­åŠ å…¥å®¹å™¨
        container.appendChild(postDiv);
    });

    // ==========================================
    //             é”å¸–æç¤ºé€»è¾‘ 
    // ==========================================
    if (threadInfo.isLocked && currentPage === threadInfo.totalPages && !onlyOP) {
        const lockDiv = document.createElement('div');
        Object.assign(lockDiv.style, {
            backgroundColor: '#fff5f5', 
            border: '2px solid #ffcdd2', 
            color: '#e57373', 
            padding: '12px 20px',
            margin: '30px auto',
            textAlign: 'center',
            borderRadius: '25px', 
            fontSize: '13px',
            fontWeight: 'bold',
            display: 'flex',
            justifyContent: 'center',
            alignItems: 'center',
            gap: '8px',
            width: '80%',
            maxWidth: '600px',
            boxShadow: '0 4px 10px rgba(255, 205, 210, 0.5)' 
        });
        
        lockDiv.innerHTML = `
            <span style="font-size:16px;">ğŸ”’</span>
            <span>æ­¤è´´å·²è¢«æ¥¼ä¸»é”å®š</span>`;
        container.appendChild(lockDiv);
    }
    
    // æ»šå›é¡¶éƒ¨
    window.scrollTo(0,0);
}


function renderPages(){
    const bar = document.getElementById("pagebar");
    bar.innerHTML = "";
    // 5. å…³é”®ä¿®æ”¹ï¼šä½¿ç”¨é…ç½®é‡Œçš„æ€»é¡µæ•°ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç çš„ 6
    const totalPages = threadInfo.totalPages; 

    for(let i = 1; i <= totalPages; i++){
        const span = document.createElement("span");
        span.innerText = i;
        if(i === currentPage) span.className = "current";
        span.onclick = () => loadPage(i);
        bar.appendChild(span);
    }
}

function toggleOP(val){
    onlyOP = val;
    document.getElementById("btnOP").className = val ? "active" : "";
    document.getElementById("btnAll").className = val ? "" : "active";
    renderPosts();
}

// å¯åŠ¨
if(threadInfo.totalPages > 0) {
    loadPage(1);
} else {
    document.getElementById("posts").innerHTML = "<div style='padding:20px;text-align:center'>å¸–å­ä¸å­˜åœ¨</div>";
}
</script>

</body>
</html>
